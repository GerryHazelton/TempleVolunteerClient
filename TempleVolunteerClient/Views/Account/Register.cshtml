@model TempleVolunteerClient.RegisterViewModel

<div class="register-form">
    <form method="post" asp-controller="Account" asp-action="Register">
        <div class="text-danger" asp-validation-summary="ModelOnly"></div>
        <div class="form-group row" style="margin-bottom:10px">
            <div class="col-4">
                <label asp-for="FirstName"></label>
            </div>
            <div class="col-8">
                <input id="firstName" asp-for="FirstName" class="form-control" />
                <span asp-validation-for="FirstName" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group row" style="margin-bottom:10px">
            <div class="col-4">
                <label asp-for="MiddleName"></label>
            </div>
            <div class="col-8">
                <input asp-for="MiddleName" class="form-control" />
                <span asp-validation-for="MiddleName" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group row" style="margin-bottom:10px">
            <div class="col-4">
                <label asp-for="LastName"></label>
            </div>
            <div class="col-8">
                <input asp-for="LastName" class="form-control" />
                <span asp-validation-for="LastName" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group row" style="margin-bottom:10px">
            <div class="col-4">
                <label asp-for="Address"></label>
            </div>
            <div class="col-8">
                <input asp-for="Address" class="form-control" />
                <span asp-validation-for="Address" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group row" style="margin-bottom:10px">
            <div class="col-4">
                <label asp-for="Address2"></label>
            </div>
            <div class="col-8">
                <input asp-for="Address2" class="form-control" />
                <span asp-validation-for="Address2" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group row" style="margin-bottom:10px">
            <div class="col-4">
                <label asp-for="City"></label>
            </div>
            <div class="col-8">
                <input asp-for="City" class="form-control" />
                <span asp-validation-for="City" class="text-danger"></span>
            </div>
        </div>
        <div id="stateId" class="form-group row" style="margin-bottom:10px">
            <div class="col-4">
                <label asp-for="State"></label>
            </div>
            <div class="col-8">
                <select asp-for="State" asp-items="Model.States" class="form-control"></select>
                <span asp-validation-for="State" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group row" style="margin-bottom:10px">
            <div class="col-4">
                <label asp-for="PostalCode"></label>
            </div>
            <div class="col-8">
                <input asp-for="PostalCode" class="form-control" />
                <span asp-validation-for="PostalCode" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group row" style="margin-bottom:10px">
            <div class="col-4">
                <label asp-for="Country"></label>
            </div>
            <div class="col-8">
                <select id="countryId" asp-for="Country" asp-items="Model.Countries" class="form-control"></select>
                <span asp-validation-for="Country" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group row" style="margin-bottom:10px">
            <div class="col-4">
                <label asp-for="PhoneNumber"></label>
            </div>
            <div class="col-8">
                <input id="phoneNumber" asp-for="PhoneNumber" class="form-control" />
                <span asp-validation-for="PhoneNumber" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group row" style="margin-bottom:10px">
            <div class="col-4">
                <label asp-for="EmailAddress"></label>
            </div>
            <div class="col-8">
                <input id="emailAddressId" asp-for="EmailAddress" class="form-control" />
                <span asp-validation-for="EmailAddress" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group row" style="margin-bottom:10px">
            <div class="col-4">
                <label asp-for="Gender"></label>
            </div>
            <div class="col-8">
                <select asp-for="Gender" asp-items="Model.GenderList" class="form-control"></select>
                <span asp-validation-for="Gender" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group row" style="margin-bottom:10px;">
            <div class="col-4">
                <label asp-for="TemplePropertyId"></label>
            </div>
            <div class="col-8">
                <select asp-for="TemplePropertyId" asp-items="Model.TemplePropertyList" class="form-control"></select>
                <span asp-validation-for="TemplePropertyId" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group row" style="margin-bottom:10px">
            <div class="col-4">
                <label asp-for="Password"></label>
            </div>
            <div class="col-8">
                <input asp-for="Password" class="form-control" />
                <span asp-validation-for="Password" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group row" style="margin-bottom:10px">
            <div class="col-4">
                <label asp-for="ConfirmPassword"></label>
            </div>
            <div class="col-8">
                <input asp-for="ConfirmPassword" class="form-control" />
                <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group row" style="margin-bottom:10px">
            <div class="col-3 offset-4">
                <button type="submit" class="btn btn-primary form-control">
                    Register
                </button>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(document).ready(function () {
            if ($("#countryId").val() !== "US" && $("#countryId").val() !== " ") {
                $("#stateId").hide();
            } else {
                $("#stateId").show();
            };

            $("#countryId").change(function () {
                var country = this.value;
                if (country !== "US") {
                    $("#stateId").hide();
                } else {
                    $("#stateId").show();
                }
            });

            var id = document.getElementById("firstName");
            id.focus();

            $('#phoneNumber').keyup(function (e) {
                var ph = this.value.replace(/\D/g, '').substring(0, 10);
                var deleteKey = (e.keyCode == 8 || e.keyCode == 46);
                var len = ph.length;
                if (len == 0) {
                    ph = ph;
                } else if (len < 3) {
                    ph = '(' + ph;
                } else if (len == 3) {
                    ph = '(' + ph + (deleteKey ? '' : ') ');
                } else if (len < 6) {
                    ph = '(' + ph.substring(0, 3) + ') ' + ph.substring(3, 6);
                } else if (len == 6) {
                    ph = '(' + ph.substring(0, 3) + ') ' + ph.substring(3, 6) + (deleteKey ? '' : '-');
                } else {
                    ph = '(' + ph.substring(0, 3) + ') ' + ph.substring(3, 6) + '-' + ph.substring(6, 10);
                }
                this.value = ph;
            });

            $("#registerForm").on("submit", function (e) {
                e.preventDefault();
                $.ajax({
                    url: '/Staff/StaffGet?registerCheck=true',
                    type: 'GET',
                    dataType: "json",
                    success: validateData,
                    error: function (result) {
                        alert('error');
                    }
                });

                function validateData(data) {
                    let exists = false;
                    $.each(data.data, function (i, item) {
                        exists = ($("#emailAddressId").val().toLowerCase().trim() == item.emailAddress.toLowerCase().trim() &&
                            (parseInt(item.staffId) != parseInt($("#hiddenId").val())));

                        if (exists) {
                            return false;
                        }
                    });

                    if (exists) {
                        swal("This email address already exists!", "");
                    }
                    else {
                        $("#registerForm").unbind("submit").submit();
                    }
                };
            });
        });
    </script>
}

